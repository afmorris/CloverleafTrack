@using Slugify
@model LeaderboardViewModel

@{
    ViewBag.Title = "Leaderboard";
}

@functions {
    string[] GetRelayAthletes(string athleteName)
    {
        return athleteName?.Split("|~|") ?? Array.Empty<string>();
    }
}

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900 dark:text-white">Leaderboard</h1>
        <p class="text-lg text-gray-600 dark:text-gray-400 mt-2">Top all-time performance for each event</p>
    </div>

    <!-- Environment Tabs -->
    <div class="mb-8">
        <div class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700 shadow-sm">
            <!-- Tab Headers -->
            <div class="flex border-b border-gray-200 dark:border-gray-700">
                <button class="env-tab flex-1 py-4 px-6 font-bold text-lg transition-all flex items-center justify-center gap-3" data-tab="outdoor">
                    ☀️ OUTDOOR
                </button>
                <button class="env-tab flex-1 py-4 px-6 font-bold text-lg transition-all flex items-center justify-center gap-3" data-tab="indoor">
                    🏢 INDOOR
                </button>
            </div>

            <!-- Tab Content Wrapper -->
            <div class="p-8">
                <!-- Outdoor Content -->
                <div id="env-outdoor" class="env-content">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Boys Outdoor -->
            <div>
                <h2 class="text-2xl font-bold text-blue-400 mb-6">♂ Boys</h2>
                
                @foreach (var category in Model.BoysOutdoorCategories)
                {
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-4">@category.CategoryName</h3>
                        
                        <div class="bg-gray-800/50 border border-gray-700 rounded-xl overflow-hidden">
                            <table class="min-w-full text-sm">
                                <tbody>
                                    @foreach (var evt in category.Events)
                                    {
                                        <tr class="event-row border-t border-gray-700/50 first:border-t-0">
                                            <td class="px-5 py-4">
                                                <a href="@Url.Action("Details", "Leaderboard", new { eventKey = evt.EventKey })" 
                                                   class="text-white hover:text-blue-400 transition-colors font-medium">
                                                    @evt.EventName
                                                </a>
                                            </td>
                                            <td class="px-5 py-4 text-right">
                                                @if (!string.IsNullOrEmpty(evt.AthleteFirstName) && !string.IsNullOrEmpty(evt.AthleteLastName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">
                                                        @evt.AthleteFirstName @evt.AthleteLastName
                                                    </div>
                                                }
                                                else if (!string.IsNullOrEmpty(evt.RelayName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">Relay Team</div>
                                                }
                                                
                                                @if (!string.IsNullOrEmpty(evt.Performance))
                                                {
                                                    <div class="font-mono font-bold text-amber-400">@evt.Performance</div>
                                                }
                                                else
                                                {
                                                    <div class="text-gray-500 italic text-xs">No performances yet</div>
                                                }
                                                
                                                @if (evt.MeetDate.HasValue && !string.IsNullOrEmpty(evt.MeetName))
                                                {
                                                    <div class="text-gray-500 text-xs mt-1">
                                                        @evt.MeetName<br />
                                                        @evt.MeetDate.Value.ToString("MMM d, yyyy")
                                                    </div>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }
            </div>

            <!-- Girls Outdoor -->
            <div>
                <h2 class="text-2xl font-bold text-pink-400 mb-6">♀ Girls</h2>
                
                @foreach (var category in Model.GirlsOutdoorCategories)
                {
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-4">@category.CategoryName</h3>
                        
                        <div class="bg-gray-800/50 border border-gray-700 rounded-xl overflow-hidden">
                            <table class="min-w-full text-sm">
                                <tbody>
                                    @foreach (var evt in category.Events)
                                    {
                                        <tr class="event-row border-t border-gray-700/50 first:border-t-0">
                                            <td class="px-5 py-4">
                                                <a href="@Url.Action("Details", "Leaderboard", new { eventKey = evt.EventKey })" 
                                                   class="text-white hover:text-pink-400 transition-colors font-medium">
                                                    @evt.EventName
                                                </a>
                                            </td>
                                            <td class="px-5 py-4 text-right">
                                                @if (!string.IsNullOrEmpty(evt.AthleteFirstName) && !string.IsNullOrEmpty(evt.AthleteLastName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">
                                                        @evt.AthleteFirstName @evt.AthleteLastName
                                                    </div>
                                                }
                                                else if (!string.IsNullOrEmpty(evt.RelayName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">Relay Team</div>
                                                }
                                                
                                                @if (!string.IsNullOrEmpty(evt.Performance))
                                                {
                                                    <div class="font-mono font-bold text-amber-400">@evt.Performance</div>
                                                }
                                                else
                                                {
                                                    <div class="text-gray-500 italic text-xs">No performances yet</div>
                                                }
                                                
                                                @if (evt.MeetDate.HasValue && !string.IsNullOrEmpty(evt.MeetName))
                                                {
                                                    <div class="text-gray-500 text-xs mt-1">
                                                        @evt.MeetName<br />
                                                        @evt.MeetDate.Value.ToString("MMM d, yyyy")
                                                    </div>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }
            </div>
        </div>
                </div>

                <!-- Indoor Content -->
                <div id="env-indoor" class="env-content hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Boys Indoor -->
            <div>
                <h2 class="text-2xl font-bold text-blue-400 mb-6">♂ Boys</h2>
                
                @foreach (var category in Model.BoysIndoorCategories)
                {
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-4">@category.CategoryName</h3>
                        
                        <div class="bg-gray-800/50 border border-gray-700 rounded-xl overflow-hidden">
                            <table class="min-w-full text-sm">
                                <tbody>
                                    @foreach (var evt in category.Events)
                                    {
                                        <tr class="event-row border-t border-gray-700/50 first:border-t-0">
                                            <td class="px-5 py-4">
                                                <a href="@Url.Action("Details", "Leaderboard", new { eventKey = evt.EventKey })" 
                                                   class="text-white hover:text-blue-400 transition-colors font-medium">
                                                    @evt.EventName
                                                </a>
                                            </td>
                                            <td class="px-5 py-4 text-right">
                                                @if (!string.IsNullOrEmpty(evt.AthleteFirstName) && !string.IsNullOrEmpty(evt.AthleteLastName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">
                                                        @evt.AthleteFirstName @evt.AthleteLastName
                                                    </div>
                                                }
                                                else if (!string.IsNullOrEmpty(evt.RelayName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">Relay Team</div>
                                                }
                                                
                                                @if (!string.IsNullOrEmpty(evt.Performance))
                                                {
                                                    <div class="font-mono font-bold text-blue-400">@evt.Performance</div>
                                                }
                                                else
                                                {
                                                    <div class="text-gray-500 italic text-xs">No performances yet</div>
                                                }
                                                
                                                @if (evt.MeetDate.HasValue && !string.IsNullOrEmpty(evt.MeetName))
                                                {
                                                    <div class="text-gray-500 text-xs mt-1">
                                                        @evt.MeetName<br />
                                                        @evt.MeetDate.Value.ToString("MMM d, yyyy")
                                                    </div>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }
            </div>

            <!-- Girls Indoor -->
            <div>
                <h2 class="text-2xl font-bold text-pink-400 mb-6">♀ Girls</h2>
                
                @foreach (var category in Model.GirlsIndoorCategories)
                {
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-4">@category.CategoryName</h3>
                        
                        <div class="bg-gray-800/50 border border-gray-700 rounded-xl overflow-hidden">
                            <table class="min-w-full text-sm">
                                <tbody>
                                    @foreach (var evt in category.Events)
                                    {
                                        <tr class="event-row border-t border-gray-700/50 first:border-t-0">
                                            <td class="px-5 py-4">
                                                <a href="@Url.Action("Details", "Leaderboard", new { eventKey = evt.EventKey })" 
                                                   class="text-white hover:text-pink-400 transition-colors font-medium">
                                                    @evt.EventName
                                                </a>
                                            </td>
                                            <td class="px-5 py-4 text-right">
                                                @if (!string.IsNullOrEmpty(evt.AthleteFirstName) && !string.IsNullOrEmpty(evt.AthleteLastName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">
                                                        @evt.AthleteFirstName @evt.AthleteLastName
                                                    </div>
                                                }
                                                else if (!string.IsNullOrEmpty(evt.RelayName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">Relay Team</div>
                                                }
                                                
                                                @if (!string.IsNullOrEmpty(evt.Performance))
                                                {
                                                    <div class="font-mono font-bold text-blue-400">@evt.Performance</div>
                                                }
                                                else
                                                {
                                                    <div class="text-gray-500 italic text-xs">No performances yet</div>
                                                }
                                                
                                                @if (evt.MeetDate.HasValue && !string.IsNullOrEmpty(evt.MeetName))
                                                {
                                                    <div class="text-gray-500 text-xs mt-1">
                                                        @evt.MeetName<br />
                                                        @evt.MeetDate.Value.ToString("MMM d, yyyy")
                                                    </div>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }
            </div>
        </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const envTabs = document.querySelectorAll('.env-tab');
        const envContents = document.querySelectorAll('.env-content');

        envTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const targetTab = this.dataset.tab;

                // Update tab styles
                envTabs.forEach(t => {
                    if (t.dataset.tab === targetTab) {
                        if (targetTab === 'outdoor') {
                            t.classList.add('bg-gradient-to-r', 'from-amber-600', 'to-yellow-500', 'text-white');
                            t.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-600', 'dark:text-gray-300', 'hover:bg-gray-200', 'dark:hover:bg-gray-600');
                        } else {
                            t.classList.add('bg-gradient-to-r', 'from-blue-600', 'to-blue-500', 'text-white');
                            t.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-600', 'dark:text-gray-300', 'hover:bg-gray-200', 'dark:hover:bg-gray-600');
                        }
                    } else {
                        t.classList.remove('bg-gradient-to-r', 'from-amber-600', 'to-yellow-500', 'from-blue-600', 'to-blue-500', 'text-white');
                        t.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-600', 'dark:text-gray-300', 'hover:bg-gray-200', 'dark:hover:bg-gray-600');
                    }
                });

                // Show/hide content
                envContents.forEach(content => {
                    if (content.id === `env-${targetTab}`) {
                        content.classList.remove('hidden');
                    } else {
                        content.classList.add('hidden');
                    }
                });
            });
        });

        // Set Outdoor as default active tab
        document.querySelector('.env-tab[data-tab="outdoor"]')?.click();
    });
</script>
