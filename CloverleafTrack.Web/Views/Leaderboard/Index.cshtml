@using Slugify
@model LeaderboardViewModel

@{
    ViewBag.Title = "Leaderboard";
}

@functions {
    string[] GetRelayAthletes(string athleteName)
    {
        return athleteName?.Split("|~|") ?? Array.Empty<string>();
    }
}

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900 dark:text-white">Leaderboard</h1>
        <p class="text-lg text-gray-600 dark:text-gray-400 mt-2">Top all-time performance for each event</p>
    </div>

    <!-- Environment Tabs -->
    <div class="mb-8">
        <div class="flex gap-3">
            <button onclick="showEnvironment('outdoor')" id="outdoor-tab" 
                    class="env-tab px-6 py-3 bg-amber-500/20 text-amber-400 rounded-lg border border-amber-500/30 font-medium transition-all hover:bg-amber-500/30">
                ☀️ OUTDOOR
            </button>
            <button onclick="showEnvironment('indoor')" id="indoor-tab"
                    class="env-tab px-6 py-3 bg-gray-800 text-gray-400 rounded-lg border border-gray-700 font-medium transition-all hover:bg-gray-750">
                🏢 INDOOR
            </button>
        </div>
    </div>

    <!-- Outdoor Content -->
    <div id="outdoor-content" class="env-content">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Boys Outdoor -->
            <div>
                <h2 class="text-2xl font-bold text-blue-400 mb-6">♂ Boys</h2>
                
                @foreach (var category in Model.BoysOutdoorCategories)
                {
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-4">@category.CategoryName</h3>
                        
                        <div class="bg-gray-800/50 border border-gray-700 rounded-xl overflow-hidden">
                            <table class="min-w-full text-sm">
                                <tbody>
                                    @foreach (var evt in category.Events)
                                    {
                                        <tr class="event-row border-t border-gray-700/50 first:border-t-0">
                                            <td class="px-5 py-4">
                                                <a href="@Url.Action("Details", "Leaderboard", new { eventKey = evt.EventKey })" 
                                                   class="text-white hover:text-blue-400 transition-colors font-medium">
                                                    @evt.EventName
                                                </a>
                                            </td>
                                            <td class="px-5 py-4 text-right">
                                                @if (!string.IsNullOrEmpty(evt.AthleteFirstName) && !string.IsNullOrEmpty(evt.AthleteLastName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">
                                                        @evt.AthleteFirstName @evt.AthleteLastName
                                                    </div>
                                                }
                                                else if (!string.IsNullOrEmpty(evt.RelayName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">Relay Team</div>
                                                }
                                                
                                                @if (!string.IsNullOrEmpty(evt.Performance))
                                                {
                                                    <div class="font-mono font-bold text-amber-400">@evt.Performance</div>
                                                }
                                                else
                                                {
                                                    <div class="text-gray-500 italic text-xs">No performances yet</div>
                                                }
                                                
                                                @if (evt.MeetDate.HasValue && !string.IsNullOrEmpty(evt.MeetName))
                                                {
                                                    <div class="text-gray-500 text-xs mt-1">
                                                        @evt.MeetName<br />
                                                        @evt.MeetDate.Value.ToString("MMM d, yyyy")
                                                    </div>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }
            </div>

            <!-- Girls Outdoor -->
            <div>
                <h2 class="text-2xl font-bold text-pink-400 mb-6">♀ Girls</h2>
                
                @foreach (var category in Model.GirlsOutdoorCategories)
                {
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-4">@category.CategoryName</h3>
                        
                        <div class="bg-gray-800/50 border border-gray-700 rounded-xl overflow-hidden">
                            <table class="min-w-full text-sm">
                                <tbody>
                                    @foreach (var evt in category.Events)
                                    {
                                        <tr class="event-row border-t border-gray-700/50 first:border-t-0">
                                            <td class="px-5 py-4">
                                                <a href="@Url.Action("Details", "Leaderboard", new { eventKey = evt.EventKey })" 
                                                   class="text-white hover:text-pink-400 transition-colors font-medium">
                                                    @evt.EventName
                                                </a>
                                            </td>
                                            <td class="px-5 py-4 text-right">
                                                @if (!string.IsNullOrEmpty(evt.AthleteFirstName) && !string.IsNullOrEmpty(evt.AthleteLastName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">
                                                        @evt.AthleteFirstName @evt.AthleteLastName
                                                    </div>
                                                }
                                                else if (!string.IsNullOrEmpty(evt.RelayName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">Relay Team</div>
                                                }
                                                
                                                @if (!string.IsNullOrEmpty(evt.Performance))
                                                {
                                                    <div class="font-mono font-bold text-amber-400">@evt.Performance</div>
                                                }
                                                else
                                                {
                                                    <div class="text-gray-500 italic text-xs">No performances yet</div>
                                                }
                                                
                                                @if (evt.MeetDate.HasValue && !string.IsNullOrEmpty(evt.MeetName))
                                                {
                                                    <div class="text-gray-500 text-xs mt-1">
                                                        @evt.MeetName<br />
                                                        @evt.MeetDate.Value.ToString("MMM d, yyyy")
                                                    </div>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Indoor Content -->
    <div id="indoor-content" class="env-content hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Boys Indoor -->
            <div>
                <h2 class="text-2xl font-bold text-blue-400 mb-6">♂ Boys</h2>
                
                @foreach (var category in Model.BoysIndoorCategories)
                {
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-4">@category.CategoryName</h3>
                        
                        <div class="bg-gray-800/50 border border-gray-700 rounded-xl overflow-hidden">
                            <table class="min-w-full text-sm">
                                <tbody>
                                    @foreach (var evt in category.Events)
                                    {
                                        <tr class="event-row border-t border-gray-700/50 first:border-t-0">
                                            <td class="px-5 py-4">
                                                <a href="@Url.Action("Details", "Leaderboard", new { eventKey = evt.EventKey })" 
                                                   class="text-white hover:text-blue-400 transition-colors font-medium">
                                                    @evt.EventName
                                                </a>
                                            </td>
                                            <td class="px-5 py-4 text-right">
                                                @if (!string.IsNullOrEmpty(evt.AthleteFirstName) && !string.IsNullOrEmpty(evt.AthleteLastName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">
                                                        @evt.AthleteFirstName @evt.AthleteLastName
                                                    </div>
                                                }
                                                else if (!string.IsNullOrEmpty(evt.RelayName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">Relay Team</div>
                                                }
                                                
                                                @if (!string.IsNullOrEmpty(evt.Performance))
                                                {
                                                    <div class="font-mono font-bold text-blue-400">@evt.Performance</div>
                                                }
                                                else
                                                {
                                                    <div class="text-gray-500 italic text-xs">No performances yet</div>
                                                }
                                                
                                                @if (evt.MeetDate.HasValue && !string.IsNullOrEmpty(evt.MeetName))
                                                {
                                                    <div class="text-gray-500 text-xs mt-1">
                                                        @evt.MeetName<br />
                                                        @evt.MeetDate.Value.ToString("MMM d, yyyy")
                                                    </div>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }
            </div>

            <!-- Girls Indoor -->
            <div>
                <h2 class="text-2xl font-bold text-pink-400 mb-6">♀ Girls</h2>
                
                @foreach (var category in Model.GirlsIndoorCategories)
                {
                    <div class="mb-8">
                        <h3 class="text-xl font-semibold text-white mb-4">@category.CategoryName</h3>
                        
                        <div class="bg-gray-800/50 border border-gray-700 rounded-xl overflow-hidden">
                            <table class="min-w-full text-sm">
                                <tbody>
                                    @foreach (var evt in category.Events)
                                    {
                                        <tr class="event-row border-t border-gray-700/50 first:border-t-0">
                                            <td class="px-5 py-4">
                                                <a href="@Url.Action("Details", "Leaderboard", new { eventKey = evt.EventKey })" 
                                                   class="text-white hover:text-pink-400 transition-colors font-medium">
                                                    @evt.EventName
                                                </a>
                                            </td>
                                            <td class="px-5 py-4 text-right">
                                                @if (!string.IsNullOrEmpty(evt.AthleteFirstName) && !string.IsNullOrEmpty(evt.AthleteLastName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">
                                                        @evt.AthleteFirstName @evt.AthleteLastName
                                                    </div>
                                                }
                                                else if (!string.IsNullOrEmpty(evt.RelayName))
                                                {
                                                    <div class="text-gray-300 text-sm mb-1">Relay Team</div>
                                                }
                                                
                                                @if (!string.IsNullOrEmpty(evt.Performance))
                                                {
                                                    <div class="font-mono font-bold text-blue-400">@evt.Performance</div>
                                                }
                                                else
                                                {
                                                    <div class="text-gray-500 italic text-xs">No performances yet</div>
                                                }
                                                
                                                @if (evt.MeetDate.HasValue && !string.IsNullOrEmpty(evt.MeetName))
                                                {
                                                    <div class="text-gray-500 text-xs mt-1">
                                                        @evt.MeetName<br />
                                                        @evt.MeetDate.Value.ToString("MMM d, yyyy")
                                                    </div>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

</div>

<script>
    function showEnvironment(env) {
        // Hide all content
        document.querySelectorAll('.env-content').forEach(el => el.classList.add('hidden'));
        
        // Show selected content
        document.getElementById(env + '-content').classList.remove('hidden');
        
        // Update tab styling
        document.querySelectorAll('.env-tab').forEach(tab => {
            tab.classList.remove('bg-amber-500/20', 'text-amber-400', 'border-amber-500/30');
            tab.classList.remove('bg-blue-500/20', 'text-blue-400', 'border-blue-500/30');
            tab.classList.add('bg-gray-800', 'text-gray-400', 'border-gray-700');
        });
        
        const activeTab = document.getElementById(env + '-tab');
        activeTab.classList.remove('bg-gray-800', 'text-gray-400', 'border-gray-700');
        
        if (env === 'outdoor') {
            activeTab.classList.add('bg-amber-500/20', 'text-amber-400', 'border-amber-500/30');
        } else {
            activeTab.classList.add('bg-blue-500/20', 'text-blue-400', 'border-blue-500/30');
        }
    }
    
    // Set outdoor as default on page load
    document.addEventListener('DOMContentLoaded', function() {
        showEnvironment('outdoor');
    });
</script>
